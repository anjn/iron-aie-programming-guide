# Section 2f - 実践的な例

## 概要

このセクションでは、「一般的なObject FIFOデータ移動パターンを含むいくつかの例」を提示します。これらの例は、「他の設計に簡単にインポートして適応できるように十分にシンプル」であり、実務者のテンプレートとして適しています。

## 5つの実践例

このセクションでは、5つの詳細な例を整理しています：

### 1. シングル/ダブルバッファ（Single/Double Buffer）

**概要:**

コア間のデータ移動をバッファリング戦略を使用して実演します。

**主な学習ポイント:**
- シングルバッファとダブルバッファの違い
- バッファリングによる並行性の実現
- レイテンシとスループットのトレードオフ

**用途:**
- 基本的なパイプライン処理
- コア間の単純なデータフロー
- バッファリング戦略の理解

**構成:**
```
Core A → Object FIFO (depth=1 or 2) → Core B
```

---

### 2. 外部メモリからコアへ（External Memory to Core）

**概要:**

ダブルバッファを介した外部メモリと処理コア間のデータ交換を示します。

**主な学習ポイント:**
- 外部メモリアクセスパターン
- DMA設定
- ダブルバッファリングによる帯域幅最適化

**用途:**
- 入力データの読み込み
- 結果の書き戻し
- 基本的なI/O操作

**構成:**
```
外部メモリ → Shim DMA → Object FIFO (depth=2) → Compute Core
```

---

### 3. L2を経由した外部メモリからコアへ（External Memory to Core through L2）

**概要:**

ダブルバッファを使用して、L2キャッシュを経由して外部メモリアクセスをルーティングします。

**主な学習ポイント:**
- メモリ階層の活用
- L2メモリタイルの役割
- 多段階データ移動

**用途:**
- 大規模データの効率的な処理
- メモリ帯域幅の最適化
- キャッシング戦略

**構成:**
```
外部メモリ → Shim DMA → Object FIFO₁ → Mem Tile (L2)
                                           ↓
                                      Object FIFO₂ → Compute Core
```

**利点:**
- L2の大容量バッファを活用
- 複数のコンピュートコアへの効率的な分散
- メモリアクセスのレイテンシ削減

---

### 4. L2からの分散（Distribute from L2）

**概要:**

L2を介して外部メモリから複数のコアにデータを分散します。

**主な学習ポイント:**
- データ並列処理パターン
- 分散ロジックの実装
- マルチコアスケーリング

**用途:**
- データ並列アルゴリズム
- ワークロードの分散
- マルチコアアプリケーション

**構成:**
```
外部メモリ → Shim DMA → Object FIFO → Mem Tile (L2)
                                           ↓
                           ┌───────────────┼───────────────┐
                           ↓               ↓               ↓
                      Object FIFO₁   Object FIFO₂   Object FIFO₃
                           ↓               ↓               ↓
                        Core 1          Core 2          Core 3
```

**分散戦略:**
- 各コアは異なるデータセグメントを受信
- オフセット管理による正確な分割
- 並列処理による性能向上

---

### 5. L2での結合（Join in L2）

**概要:**

L2を通じて複数のコアからのデータを外部メモリに集約します。

**主な学習ポイント:**
- 結果の集約パターン
- 結合ロジックの実装
- 複数ソースからのデータ統合

**用途:**
- 並列処理結果の収集
- MapReduceパターン
- マルチコア出力の統合

**構成:**
```
Core 1 → Object FIFO₁ ↘
Core 2 → Object FIFO₂ → Mem Tile (L2) → Object FIFO → Shim DMA → 外部メモリ
Core 3 → Object FIFO₃ ↗
```

**結合戦略:**
- 各コアの出力を正しい順序で結合
- オフセット管理による正確な配置
- 効率的なメモリアクセス

---

## パターンの組み合わせ

これらの基本パターンは、より複雑な設計のビルディングブロックとして使用できます：

### 例：完全なパイプライン

```
外部メモリ → [例2] → Core (処理1) → [例1] → Core (処理2) → [例5] → 外部メモリ
```

### 例：データ並列処理

```
外部メモリ → [例4: 分散] → 複数Core (並列処理) → [例5: 結合] → 外部メモリ
```

## 実装のベストプラクティス

### バッファリング

- **シングルバッファ**: メモリ使用量最小、並行性なし
- **ダブルバッファ**: バランスの取れた選択、一般的に推奨
- **トリプルバッファ以上**: 高スループット要求時

### メモリ階層の活用

1. **L1（コアローカル）**: 最高速、容量小
2. **L2（メモリタイル）**: 中速、中容量、複数コアで共有
3. **L3（外部メモリ）**: 低速、大容量

### 性能最適化

- データの局所性を最大化
- 不要なコピーを削減
- DMA転送を効率化
- 並行実行の機会を活用

## 各例へのアクセス

各例には、個別のリンクを介してアクセス可能な専用ドキュメントがあります。完全な実装コードとビルド手順が含まれています。

---

**注意**: 各例の完全なソースコードと詳細な説明については、[公式ドキュメント](https://github.com/Xilinx/mlir-aie/tree/main/programming_guide/section-2/section-2f)を参照してください。

-----

[[前へ - Section 2e](../section-2e/README.md)] [[次へ - Section 2g](../section-2g/README.md)] [[トップ](../../README.md)]
